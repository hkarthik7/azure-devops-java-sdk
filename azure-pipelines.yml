name: $(Build.BuildID)

trigger:
  - main

resources:
  - repo: self

variables:
  - template: templates/variables.yml

stages:
  - template: templates/build-test-stage.yml
    parameters:
      stageName: 'Build_Test_Linux'
      displayName: 'Build and Test on Linux'
      vmImage: 'ubuntu-latest'

  - template: templates/build-test-stage.yml
    parameters:
      stageName: 'Build_Test_Windows'
      displayName: 'Build and Test on Windows'
      vmImage: 'windows-latest'

  - template: templates/publish-stage.yml
    parameters:
      dependsOn: ['Build_Test_Linux', 'Build_Test_Windows']